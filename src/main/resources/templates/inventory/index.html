<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="partials :: head('WasteManagement')" />

<body>
<div th:replace="partials :: myNav"></div>
    <h1>Inventory List    <button class="btn btn-success" th:name="create" th:type="submit" th:value="Create"><a class="link text-light" th:href="@{'/inventory/create'}">Create Item</a></button></h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Size</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity Available</th>
                <th scope="col">Edit/Delete</th>
            </tr>
        </thead>
        <tbody th:action="@{/inventory}" th:method="post" th:object="${inventory}">
            <tr th:each="item : ${inventory}">
                <th scope="row" th:text="${item.name}"></th>
                <td th:text="${item.size}"></td>
                <td th:text="'$'+ ${item.price}"></td>
                <td th:text="${item.quantity}"></td>
                <td>
                <button class="btn btn-warning" th:name="edit" th:type="submit" th:value="Edit"><a class="link text-light" th:href="@{'/inventory/' + ${item.id} + '/edit'}">EDIT</a></button>
                <input type="hidden" id="itemId" th:value="${item.id}"/>
                    <form th:action="@{'/inventory/{id}/delete' (id=${item.id})}" method="get" th:object="${inventory}" class="mb-3">
                        <input type="hidden" name="_method" value="delete" />
                        <button type="submit" class="link btn btn-danger text-light" th:method="delete">DELETE</button>
                    </form>
                    <!--<button id="delete-item" class="btn btn-danger">Delete</button>-->
                <!--<ul class="nav nav-pills justify-content-center mt-auto form-group">-->
                    <!--<li class="nav-item font-weight-bold w-50"><a th:href="@{'/work-order/' + ${item.id}}" class="nav-link">Work Order Link</a></li>-->
                <!--</ul>-->

                </td>
            </tr>
        </tbody>
    </table>

<th:block th:replace="partials :: scripts" />

<script>

    //------------------------------------------ JavaScript to Delete Inventory Items ----------------------------------//

    //1) query the document for the element id of the delete button and assign it to a variable
    //2) query the document for the element id of the inventory item's id and assign it to a variable

    let deleteItem = document.querySelector("#delete-item");
    let itemId = document.querySelector("#itemId").value();

    //3) add an event listener to the delete button that functions on a click and prevent the action from reocurring
    //4) confirm if the user wants to complete the action and set it to a variable
    //5) if the user confirms, fetch the delete url with the id and use a post method
    //6) then take the confirmation variable, get the json, then redirect to the inventory page to show the updated
    //   inventory

    deleteItem.addEventListener('click',function(e) {
        e.preventDefault();
        let result = confirm("Are you sure you want to delete this item? It cannot be undone.");
        if(result){
            fetch(`/inventory/${itemId}/delete`, {
                method:"POST"}).then(result=> result.json()).then(() => location.href= "/inventory");
        }

    });


</script>

</body>
</html>